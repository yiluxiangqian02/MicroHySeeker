# MicroHySeeker 运行指南与测试方案

## 快速启动

### 前置条件
- Python 3.9 或以上
- 已安装依赖包（见 `requirements.txt`）

### 安装依赖
```bash
cd f:\BaiduSyncdisk\micro1229\MicroHySeeker
pip install -r requirements.txt
```

### 运行主界面
```bash
cd f:\BaiduSyncdisk\micro1229\MicroHySeeker
python run_ui.py
```

界面应在 1-2 秒内启动，显示主窗口、步骤列表、绘图区、日志区等。

---

## 功能模块检查清单

### 1. 主界面
- ✅ 窗口正常打开
- ✅ 菜单栏（文件、工具、实验、帮助）
- ✅ 左侧步骤列表
- ✅ 右侧上方绘图区（空白但可交互）
- ✅ 右侧下方日志区（绿色文本）
- ✅ 状态栏

### 2. 菜单与功能
- 文件菜单：新建、打开、保存实验
- 工具菜单：系统配置、手动控制、泵校准
- 实验菜单：编辑程序
- 帮助菜单：关于

### 3. 系统配置对话
点击 工具 → 系统配置
- ✅ RS485 串口选择（COM1-COM6）
- ✅ 连接/断开按钮
- ✅ 扫描泵按钮（可选，需真实硬件）
- ✅ 配液通道表格（可添加/删除）
- ✅ 冲洗通道表格（可添加/删除）
- ✅ 保存配置功能

### 4. 手动控制对话
点击 工具 → 手动控制
- ✅ 泵地址下拉选择（1-12）
- ✅ 转速输入框
- ✅ 运行/停止/正转/反转按钮
- ✅ 命令日志显示

### 5. 泵校准对话
点击 工具 → 泵校准
- ✅ 泵地址选择
- ✅ 目标体积输入
- ✅ 转速设置
- ✅ 开始/停止按钮
- ✅ 实际体积录入
- ✅ 计算与保存标定因子

### 6. 程序编辑器
点击 实验 → 编辑程序
- ✅ 步骤列表（左侧）
- ✅ 添加/删除/上移/下移按钮
- ✅ 动态编辑面板（右侧）
- ✅ 操作类型选择（Transfer/PrepSol/Flush/EChem/Blank）
- ✅ Transfer：泵地址、方向、转速、体积
- ✅ PrepSol：目标浓度、是否溶剂、注液顺序、总体积
- ✅ Flush：泵地址、转速、循环时长、循环次数
- ✅ EChem：技术选择（CV/LSV/i-t）、电位、扫描速率、OCPT 设置
- ✅ OCPT 反向电流检测开关与参数

---

## 测试实验方案

### 方案 A：配液与冲洗（推荐先测试）

1. **启动应用**
   ```
   python run_ui.py
   ```

2. **系统配置**
   - 菜单 → 工具 → 系统配置
   - 选择 RS485 串口（如 COM1，需实际硬件或模拟器）
   - 点击"连接"
   - 添加配液通道：
     - 通道 ID: Dilution_1
     - 溶液名: SolutionA
     - 浓度: 0.1 mol/L
     - 泵地址: 1
     - 方向: FWD
     - 默认转速: 100 RPM
   - 添加冲洗通道：
     - 通道 ID: Flush_1
     - 泵名: PumpB
     - 泵地址: 2
     - 方向: FWD
     - 转速: 100 RPM
     - 循环时长: 30 s
   - 保存配置

3. **编辑程序**
   - 菜单 → 实验 → 编辑程序
   - 点击"添加"创建步骤1
   - 类型选择"Transfer"：移液
     - 泵地址: 1
     - 方向: FWD
     - 转速: 100 RPM
     - 体积: 500 uL
   - 点击"添加"创建步骤2
   - 类型选择"Flush"：冲洗
     - 泵地址: 2
     - 转速: 100 RPM
     - 循环时长: 30
     - 循环次数: 2
   - 保存程序

4. **运行实验**
   - 主界面步骤列表应显示 2 个步骤
   - 点击"运行"按钮
   - 观察日志区显示步骤执行信息
   - 绘图区保持实时刷新

### 方案 B：电化学实验（包含 OCPT 检测）

1. 接续"方案 A"的系统配置

2. **编辑程序**
   - 菜单 → 实验 → 编辑程序
   - 点击"添加"创建步骤
   - 类型选择"EChem"：电化学
   - 技术选择"CV"（循环伏安）
     - E0: 0.0 V
     - EH: 0.5 V
     - EL: -0.5 V
     - 扫描速率: 0.05 V/s
     - 采样间隔: 100 ms
     - 运行时间: 60 s
   - 启用 OCPT：勾选
     - OCPT 阈值: -50 μA
     - OCPT 动作: log（或 pause/abort）
     - 监测窗口: 100 ms
   - 保存程序

3. **运行实验**
   - 点击"运行"
   - 观察日志区显示电化学执行信息
   - 绘图区应开始绘制数据点（绿色曲线）
   - 若模拟电流触发 OCPT 阈值，日志显示"[OCPT] 触发!"

### 方案 C：多步骤复杂实验

结合 Transfer、PrepSol、Flush、EChem 步骤：

1. 配液（PrepSol）：目标浓度 0.05 mol/L，总体积 1000 uL
2. 移液（Transfer）：500 uL
3. 冲洗（Flush）：10 秒
4. 电化学（EChem）：LSV 扫描，扫描速率 0.02 V/s，时长 30 s

---

## 关键界面操作

### 系统配置
```
菜单 → 工具 → 系统配置
├─ RS485 串口选择 + 连接/扫描
├─ 配液通道表（可编辑）
│  ├ 通道ID
│  ├ 溶液名
│  ├ 浓度(mol/L)
│  ├ 泵地址(1-12)
│  ├ 方向(FWD/REV)
│  ├ 默认转速(RPM)
│  └ 颜色
├─ 冲洗通道表（可编辑）
│  ├ 通道ID
│  ├ 泵名
│  ├ 泵地址
│  ├ 方向
│  ├ 转速
│  └ 循环时长
└─ 保存/取消
```

### 手动控制
```
菜单 → 工具 → 手动控制
├─ 泵地址选择(1-12)
├─ 转速设置(RPM)
├─ 控制按钮
│  ├ 运行(正转)
│  ├ 停止
│  ├ 正转
│  └ 反转
└─ 命令日志
```

### 程序编辑
```
菜单 → 实验 → 编辑程序
├─ 步骤列表（左）
│  ├ 添加
│  ├ 删除
│  ├ 上移/下移
│  └ 步骤预览
├─ 编辑区（右）
│  └─ 操作类型（下拉选择）
│     ├─ Transfer: 泵参数 + 体积
│     ├─ PrepSol: 浓度 + 注液顺序 + 总体积
│     ├─ Flush: 泵参数 + 循环
│     ├─ EChem: 技术 + 电位 + OCPT
│     └─ Blank: 空步骤
└─ 保存/关闭
```

---

## 预期行为

### 启动后
- 主窗口显示"MicroHySeeker - 自动化实验平台"
- 日志区初始消息："[启动] MicroHySeeker 已启动"
- 状态栏显示"就绪"

### 配置与运行
- 配置保存到 `./config/system.json`（自动创建）
- 实验保存到 `./experiments/*.json`
- 运行时日志持续更新
- 绘图区在 EChem 步骤时显示绿色曲线

### 错误处理
- 串口连接失败：弹窗提示
- 泵命令失败：日志显示"执行失败"
- OCPT 触发：日志显示"[OCPT] 触发!"

---

## 常见问题

**Q: 启动时显示缺少模块？**
A: 运行 `pip install -r requirements.txt`

**Q: 找不到 RS485 驱动？**
A: 确保 `485test/通讯` 目录在父路径中且包含 `comm/` 模块。

**Q: 没有真实硬件，能否测试？**
A: 可以。模拟模式下，所有泵命令返回成功，日志显示操作记录。

**Q: 怎样导出实验结果？**
A: 暂未实现导出功能（可在后续版本添加）。

---

## 下一步改进
- [ ] 电流/电位数据实时绘图优化
- [ ] 配置文件版本管理
- [ ] 多实验队列运行
- [ ] 数据导出（CSV/Excel）
- [ ] 中文/英文切换
