# ğŸš€ MicroHySeeker æ¸è¿›å¼å¼€å‘è®¡åˆ’

> **å¼€å‘ç­–ç•¥**: æ¯ä¸ªé˜¶æ®µéƒ½èƒ½ä¸å‰ç«¯è”åˆæµ‹è¯•ï¼Œé€æ­¥è§£å†³é—®é¢˜å¹¶æ¨è¿›

## å½“å‰çŠ¶æ€

âœ… **é˜¶æ®µ1**: RS485 åŸºç¡€é©±åŠ¨ (ä½ å·²å®Œæˆ)
- `src/echem_sdl/hardware/rs485_driver.py` 
- `src/echem_sdl/hardware/rs485_protocol.py`

## å¼€å‘è·¯å¾„

### ğŸ¯ é˜¶æ®µ2ï¼šåŸºæœ¬æ³µç®¡ç† (çº¦2-3å°æ—¶)

**ç›®æ ‡**: è®©å‰ç«¯çš„"æ‰‹åŠ¨æ§åˆ¶"åŠŸèƒ½å·¥ä½œ

**è¦å®ç°çš„æ¨¡å—**:
```
src/echem_sdl/
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ constants.py     â† å¸¸é‡å®šä¹‰
â”‚   â””â”€â”€ errors.py        â† å¼‚å¸¸å®šä¹‰  
â”œâ”€â”€ hardware/
â”‚   â””â”€â”€ pump_manager.py  â† æ³µç®¡ç†å™¨ (ç®€åŒ–ç‰ˆ)
â””â”€â”€ lib_context.py       â† ä¾èµ–æ³¨å…¥ (æœ€å°å®ç°)
```

**å‰ç«¯é›†æˆæµ‹è¯•ç‚¹**:
- [æ‰‹åŠ¨æ§åˆ¶å¯¹è¯æ¡†](src/dialogs/manual_control.py) - èƒ½å¯åŠ¨/åœæ­¢æ³µ
- [é…ç½®å¯¹è¯æ¡†](src/dialogs/config_dialog.py) - èƒ½æ‰«æRS485è®¾å¤‡
- ä¸»ç•Œé¢æ³µçŠ¶æ€æŒ‡ç¤ºå™¨èƒ½æ˜¾ç¤ºè¿è¡ŒçŠ¶æ€

**æµ‹è¯•æ–¹å¼**:
```bash
python run_ui.py
# 1. ç‚¹å‡»"é…ç½®" -> "RS485é…ç½®" -> "æ‰«æè®¾å¤‡"
# 2. ç‚¹å‡»"æ‰‹åŠ¨æ§åˆ¶" -> å¯åŠ¨ä»»æ„æ³µ -> è§‚å¯ŸçŠ¶æ€å˜åŒ–
# 3. ä¸»ç•Œé¢æ³µå›¾æ ‡åº”è¯¥å˜ç»¿è‰²
```

---

### ğŸ¯ é˜¶æ®µ3ï¼šé…æ¶²åŠŸèƒ½ (çº¦3-4å°æ—¶) 

**ç›®æ ‡**: è®©å‰ç«¯çš„"é…ç½®æº¶æ¶²"åŠŸèƒ½å·¥ä½œ

**è¦å®ç°çš„æ¨¡å—**:
```
src/echem_sdl/
â”œâ”€â”€ hardware/
â”‚   â””â”€â”€ diluter.py       â† é…æ¶²å™¨
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ settings_service.py  â† é…ç½®ç®¡ç†
â”‚   â””â”€â”€ logger_service.py    â† æ—¥å¿—æœåŠ¡
```

**å‰ç«¯é›†æˆæµ‹è¯•ç‚¹**:
- [é…ç½®æº¶æ¶²å¯¹è¯æ¡†](src/dialogs/prep_solution.py) - èƒ½è®¡ç®—å¹¶æ‰§è¡Œé…æ¶²
- ä¸»ç•Œé¢èƒ½æ˜¾ç¤ºé…æ¶²è¿›åº¦
- é…æ¶²å®Œæˆåæº¶æ¶²æµ“åº¦æ›´æ–°

**æµ‹è¯•æ–¹å¼**:
```bash
python run_ui.py
# 1. ç‚¹å‡»"é…ç½®æº¶æ¶²"
# 2. é€‰æ‹©é€šé“ï¼Œè¾“å…¥ç›®æ ‡æµ“åº¦ï¼Œç‚¹å‡»"å¼€å§‹é…æ¶²"  
# 3. è§‚å¯Ÿè¿›åº¦æ¡å’Œæ—¥å¿—è¾“å‡º
```

---

### ğŸ¯ é˜¶æ®µ4ï¼šå†²æ´—ç³»ç»Ÿ (çº¦2-3å°æ—¶)

**ç›®æ ‡**: è®©å‰ç«¯çš„å†²æ´—åŠŸèƒ½å·¥ä½œ

**è¦å®ç°çš„æ¨¡å—**:
```
src/echem_sdl/
â””â”€â”€ hardware/
    â””â”€â”€ flusher.py       â† å†²æ´—å™¨
```

**å‰ç«¯é›†æˆæµ‹è¯•ç‚¹**:
- [å†²æ´—å¯¹è¯æ¡†](src/dialogs/flusher_dialog.py) - èƒ½æ‰§è¡Œå†²æ´—å¾ªç¯
- ä¸»ç•Œé¢èƒ½æ˜¾ç¤ºå†²æ´—è¿›åº¦

**æµ‹è¯•æ–¹å¼**:
```bash
python run_ui.py
# 1. ç‚¹å‡»"å†²æ´—ç³»ç»Ÿ"
# 2. è®¾ç½®å†²æ´—å‚æ•°ï¼Œå¼€å§‹å†²æ´—
# 3. è§‚å¯Ÿä¸‰ä¸ªæ³µçš„åè°ƒå·¥ä½œ
```

---

### ğŸ¯ é˜¶æ®µ5ï¼šå®éªŒå¼•æ“ (çº¦4-5å°æ—¶)

**ç›®æ ‡**: è®©è‡ªåŠ¨åŒ–å®éªŒè¿è¡Œ

**è¦å®ç°çš„æ¨¡å—**:
```
src/echem_sdl/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ prog_step.py         â† ç¨‹åºæ­¥éª¤
â”‚   â”œâ”€â”€ exp_program.py       â† å®éªŒç¨‹åº  
â”‚   â””â”€â”€ experiment_engine.py â† å®éªŒå¼•æ“
â””â”€â”€ hardware/
    â””â”€â”€ chi.py               â† CHIä»ªå™¨ (Mockç‰ˆæœ¬)
```

**å‰ç«¯é›†æˆæµ‹è¯•ç‚¹**:
- [ç¨‹åºç¼–è¾‘å™¨](src/dialogs/program_editor.py) - èƒ½ç¼–è¾‘å’Œä¿å­˜å®éªŒç¨‹åº
- [ç»„åˆå®éªŒç¼–è¾‘å™¨](src/dialogs/combo_exp_editor.py) - èƒ½è®¾ç½®ç»„åˆå®éªŒ
- ä¸»ç•Œé¢èƒ½è¿è¡Œå®Œæ•´å®éªŒæµç¨‹

**æµ‹è¯•æ–¹å¼**:
```bash  
python run_ui.py
# 1. ç¼–è¾‘å®éªŒç¨‹åºï¼šé…æ¶²->å†²æ´—->ç”µåŒ–å­¦->æ’ç©º
# 2. ç‚¹å‡»"è¿è¡Œå®éªŒ"
# 3. è§‚å¯Ÿæ•´ä¸ªè‡ªåŠ¨åŒ–æµç¨‹
```

---

## ğŸ”§ æ¯ä¸ªé˜¶æ®µçš„å¼€å‘æµç¨‹

### 1. å®ç°åç«¯æ¨¡å—
- æŒ‰ç…§ `docs/backend/XX_æ¨¡å—.md` æ–‡æ¡£å®ç°
- é‡ç‚¹å…³æ³¨å‰ç«¯æ¥å£éƒ¨åˆ†
- å…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼Œç»†èŠ‚åç»­å®Œå–„

### 2. åˆ›å»ºé›†æˆæ¡¥æ¢
```python
# ä¾‹å¦‚ï¼šsrc/services/rs485_wrapper.py
def get_rs485_instance():
    """è·å–RS485å®ä¾‹ - å‰åç«¯æ¡¥æ¢"""
    return LibContext.get_pump_manager().driver
```

### 3. å‰ç«¯è”åˆæµ‹è¯•
- è¿è¡Œ `python run_ui.py`
- æµ‹è¯•å¯¹åº”åŠŸèƒ½
- è®°å½•æŠ¥é”™å’Œé—®é¢˜

### 4. è°ƒè¯•è§£å†³
- æ ¹æ®å‰ç«¯æŠ¥é”™ä¿®å¤åç«¯
- æ·»åŠ æ—¥å¿—å’Œå¼‚å¸¸å¤„ç†
- å®Œå–„é”™è¯¯æç¤º

### 5. åŠŸèƒ½éªŒè¯
- ç¡®ä¿è¯¥é˜¶æ®µåŠŸèƒ½å®Œå…¨å·¥ä½œ
- å†™ç®€å•çš„æµ‹è¯•è„šæœ¬éªŒè¯
- è¿›å…¥ä¸‹ä¸€é˜¶æ®µ

---

## ğŸš¨ å…³é”®é›†æˆç‚¹

### LibContext ç»Ÿä¸€å…¥å£
```python
# src/echem_sdl/lib_context.py
class LibContext:
    _pump_manager = None
    _experiment_engine = None
    
    @classmethod 
    def get_pump_manager(cls):
        if not cls._pump_manager:
            driver = RS485Driver(mock_mode=True)  # å¼€å‘æœŸç”¨Mock
            cls._pump_manager = PumpManager(driver)
        return cls._pump_manager
```

### å‰ç«¯wrapperé€‚é…
```python
# src/services/rs485_wrapper.py  
def get_rs485_instance():
    return LibContext.get_pump_manager()

def start_pump(addr, direction, rpm):
    return LibContext.get_pump_manager().start_pump(addr, direction, rpm)
```

### ç»Ÿä¸€é”™è¯¯å¤„ç†
```python
# å‰ç«¯è°ƒç”¨æ—¶æ•è·åç«¯å¼‚å¸¸
try:
    success = rs485.start_pump(1, "FWD", 120)
except CommunicationTimeoutError:
    QMessageBox.warning("é€šä¿¡è¶…æ—¶")
except Exception as e:
    QMessageBox.critical(f"æœªçŸ¥é”™è¯¯: {e}")
```

---

## â­ å»ºè®®çš„å¼€å‘èŠ‚å¥

**ç¬¬ä¸€å¤©**: å®Œæˆé˜¶æ®µ2ï¼Œè®©æ‰‹åŠ¨æ§åˆ¶å·¥ä½œ  
**ç¬¬äºŒå¤©**: å®Œæˆé˜¶æ®µ3ï¼Œè®©é…æ¶²åŠŸèƒ½å·¥ä½œ  
**ç¬¬ä¸‰å¤©**: å®Œæˆé˜¶æ®µ4+5ï¼Œå®ç°å®Œæ•´æµç¨‹

æ¯ä¸ªé˜¶æ®µéƒ½æœ‰æ˜ç¡®çš„**å‰ç«¯éªŒè¯ç›®æ ‡**ï¼Œé¿å…å†™äº†ä¸€å †ä»£ç å´ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨çš„æƒ…å†µã€‚

---

## ğŸ¯ ç«‹å³å¼€å§‹

1. **è¿è¡ŒRS485æµ‹è¯•**: `python test_rs485_connection.py` 
2. **ç¡®è®¤æµ‹è¯•é€šè¿‡å**ï¼Œå¼€å§‹é˜¶æ®µ2çš„å¼€å‘
3. **æ¯å®Œæˆä¸€ä¸ªæ¨¡å—**ï¼Œç«‹å³ç”¨å‰ç«¯æµ‹è¯•

è¿™æ ·ä½ å°±èƒ½çœ‹åˆ°æ¯ä¸€æ­¥çš„æˆæœï¼Œé—®é¢˜ä¹Ÿèƒ½åŠæ—¶å‘ç°å’Œè§£å†³ï¼